
# Calculate the cracking time of a hash

Before we begin cracking passwords, let's calculate the cracking time of various hash representations.
The cracking time can be calculated by dividing the ***keyspace*** with the hash rate.

The ***keyspace*** consists of the character set to the power of the amount of characters or length of the original information (password).
- For example, if we use the lower-case Latin alphabet (26 characters), upper case alphabet (26 characters), and the numbers from 0 to 9 (10 characters), we have a character set of 62 possible variations for every character. If we are faced with a five-character password, we are facing 62 to the power of five possible passwords containing these five characters

Calculating crack time
```bash
# Calculate the keyspace  for a 5 char pw using all lowercase, uppercase, and 0-9 digits (62 possible chars per pw char position)
python3 -c "print(62**5)"
	916132832

# Calculate the hash rate
hashcat -b
	* Device #1: pthread-haswell-AMD Ryzen 7 5700U with Radeon Graphics, 6626/13316 MB (2048 MB allocatable), 16MCU
	
	Benchmark relevant options:
	===========================
	* --optimized-kernel-enable
	
	-------------------
	* Hash-Mode 0 (MD5)
	-------------------
	
	Speed.#1.........:   978.1 MH/s (16.32ms) @ Accel:1024 Loops:1024 Thr:1 Vec:8
	
	----------------------
	* Hash-Mode 100 (SHA1)
	----------------------
	
	Speed.#1.........:   421.1 MH/s (38.52ms) @ Accel:1024 Loops:1024 Thr:1 Vec:8
	
	---------------------------
	* Hash-Mode 1400 (SHA2-256)
	---------------------------
	
	Speed.#1.........:   154.0 MH/s (54.25ms) @ Accel:512 Loops:1024 Thr:1 Vec:8

# Calculate crack time GPU in seconds
python3 -c "print(916132832 / 154000000)"
	5.948914493506494
```


# Rule-based Attack

https://hashcat.net/wiki/doku.php?id=rule_based_attack

Automating the process of changing (or _mutating_) a wordlist before sending it to a target
- Used when complex passwords are enforced
- Increases number of attempted passwords tremendously.  Careful getting locked out.

Create a rule file containing one or more rules and use it with a cracking tool.

Individual rules are implemented through **rule functions**, which are used to modify existing passwords contained in a wordlist.
An individual rule consists of one or more rule functions. We will often use multiple rule functions in each rule.

A way to craft a mutated list to fit a rule function like a Capitalized character, Special Character, and Numerical value

#### When asked to put a number in a pw, people usually append numbers
```bash
# Prep a wordlist to attack a Rule Function
head /usr/share/wordlists/rockyou.txt > demo.txt

# Remove only digit passwords
sed -i '/^1/d' demo.txt

cat demo.txt
	password
	iloveyou
	princess
	rockyou
	abc123

# Create a rule file to append a 1 to each
	# Escape the special character "$" to echo it into the file correctly.
echo \$1 > demo.rule

# Test
	# -r specifies the rule list
	# --stdout specifies debugging mode (only displays mutated list)
hashcat -r demo.rule --stdout demo.txt
	password1
	iloveyou1
	princess1
	rockyou1
	abc1231
```

The [Hashcat](https://hashcat.net/wiki/doku.php?id=rule_based_attack) Wiki provides a list of all possible rule functions with examples.
If we want to add a character, the simplest form is to prepend or append it.
- **$** function to append
- **^** to prepend

Both of these functions expect one character after the function selector.
- For example, if we want to prepend a "3" to every password in a file, the corresponding rule function would be ^3.

#### When asked to put an uppercase letter in a pw, people usually use them as the first letter
```bash
# Craft rule file for permutations
# Rule functions are on the same line separated by a space
echo "$1 c" > demo1.txt

# Test
# Uses them consecutively on each pw of the wordlist
# Result is that the first character of each pw is capitalized & a 1 appended to each
hashcat -r demo1.rule --stdout demo.txt
	Password1
	Iloveyou1
	Princess1
	Rockyou1
	Abc1231

# Craft another rule file for permutations
# Rule functions are on separate lines.
cat > demo2.txt
$1
c
# Ctrl + D

# Test
# Second line is interpreted as a new rule
# Each rule is used separately, resulting in two mutated passwords for every password from the wordlist.
hashcat -r demo2.rule --stdout demo.txt
	password1
	Password
	iloveyou1
	Iloveyou
	princess1
	Princess
```

#### When asked to put a special character in a pw, people usually use them at the end either before or after numbers
```bash
# Add $! to end of the passwords
echo "$1 c $!" > demo1.txt

# Test
hashcat -r demo1.rule --stdout demo.txt
	Password1!
	Iloveyou1!
	Princess1!
	Rockyou1!
	Abc1231!

# Craft another rule file for permutations
# Rule functions are on separate lines.
echo "$! $1 c" > demo2.txt

# Test
hashcat -r demo2.rule --stdout demo.txt
	Password!1
	Iloveyou!1
	Princess!1
	Rockyou!1
	Abc123!1
```

Rules are applied left to right, so
- **demo1.txt** -> Append '1', Capitalize, Append '!'
- **demo2.txt** -> Append '!', Append '1', Capitalize

#### Adjust rockyou for a password policy requiring an upper case letter, a numerical value, and a special to crack a hash
```bash
# Create file with discovered hash
echo "f621b6c9eab51a3e2f4e167fee4c6860" > crackme.txt

# Create rule file to append the "ever-popular" '1', '2', and '123'
echo "$1 c $!" > demo3.rule
echo "$2 c $!" >> demo3.rule
echo "$1 $2 $3 c $!" >> demo3.rule

# Crack
hashcat -m 0 crackme.txt /usr/share/wordlists/rockyou.txt -r demo3.rule --force
	f621b6c9eab51a3e2f4e167fee4c6860:Computer123!
```


Always consider human behavior and convenience with regard to passwords
- Most users use a main word and modify it to fit a password policy, perhaps appending numbers and special characters.
- When an upper case letter is required, most users capitalize the first letter.
- When special characters are required, most users add the special character at the end of the password and rely on characters on the left side of the keyboard since these digits are easy to reach and type

Can also use Hashcat's rules as well
```bash
ls -la /usr/share/hashcat/rules/
	total 2588
	-rw-r--r-- 1 root root    933 Dec 23 08:53 best64.rule
	-rw-r--r-- 1 root root    666 Dec 23 08:53 combinator.rule
	-rw-r--r-- 1 root root 200188 Dec 23 08:53 d3ad0ne.rule
	-rw-r--r-- 1 root root 788063 Dec 23 08:53 dive.rule
	-rw-r--r-- 1 root root 483425 Dec 23 08:53 generated2.rule
	-rw-r--r-- 1 root root  78068 Dec 23 08:53 generated.rule
	drwxr-xr-x 2 root root   4096 Feb 11 01:58 hybrid
	-rw-r--r-- 1 root root 309439 Dec 23 08:53 Incisive-leetspeak.rule
	-rw-r--r-- 1 root root  35280 Dec 23 08:53 InsidePro-HashManager.rule
	-rw-r--r-- 1 root root  19478 Dec 23 08:53 InsidePro-PasswordsPro.rule
	-rw-r--r-- 1 root root    298 Dec 23 08:53 leetspeak.rule
	-rw-r--r-- 1 root root   1280 Dec 23 08:53 oscommerce.rule
	-rw-r--r-- 1 root root 301161 Dec 23 08:53 rockyou-30000.rule
	-rw-r--r-- 1 root root   1563 Dec 23 08:53 specific.rule
	-rw-r--r-- 1 root root  64068 Dec 23 08:53 T0XlC-insert_00-99_1950-2050_toprules_0_F.rule
	...
```


